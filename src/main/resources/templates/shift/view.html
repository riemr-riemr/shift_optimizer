<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>シフト割当一覧</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script>
        async function solveShift() {
            const storeCode = document.getElementById("storeCode").value;
            const date = document.getElementById("date").value;
            const response = await fetch(`/api/shift/solve?storeCode=${storeCode}&from=${date}&to=${date}`, {
                method: 'POST'
            });
            if (response.ok) {
                window.location.href = `/shift/view?storeCode=${storeCode}&date=${date}`;
            } else {
                alert("シフト生成に失敗しました");
            }
        }

        function exportCsv() {
            const storeCode = document.getElementById("storeCode").value;
            const date = document.getElementById("date").value;
            window.location.href = `/api/shift/export?storeCode=${storeCode}&date=${date}`;
        }
    </script>
</head>
<body>
<div class="container mt-4">
    <h2 class="mb-4">シフト割当検索</h2>
    <form class="row g-3 mb-4" method="get" th:action="@{/shift/view}">
        <div class="col-md-4">
            <label for="storeCode" class="form-label">店舗コード</label>
            <input type="text" class="form-control" id="storeCode" name="storeCode" th:value="${storeCode}" required>
        </div>
        <div class="col-md-4">
            <label for="date" class="form-label">対象日</label>
            <input type="date" class="form-control" id="date" name="date" th:value="${date}" required>
        </div>
        <div class="col-md-4 d-flex align-items-end">
            <button type="submit" class="btn btn-primary me-2">検索</button>
            <button type="button" class="btn btn-success" onclick="solveShift()">シフト生成</button>
            <button type="button" class="btn btn-secondary" onclick="exportCsv()">CSV出力</button>
        </div>
    </form>

    <h2 th:text="'店舗: ' + ${storeCode} + ' のシフト一覧（' + ${date} + '）'"></h2>
    <table class="table table-bordered table-striped">
        <thead>
        <tr>
            <th>従業員コード</th>
            <th>従業員名</th>
            <th>レジ番号</th>
            <th>レジ名</th>
            <th>開始時刻</th>
            <th>終了時刻</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="a : ${assignments}">
            <td th:text="${a.employee?.employeeCode}">A001</td>
            <td th:text="${a.employee?.employeeName}">山田</td>
            <td th:text="${a.register?.registerNo}">1</td>
            <td th:text="${a.register?.registerName}">レジ1</td>
            <td th:text="${#temporals.format(a.startAt, 'HH:mm')}">08:00</td>
            <td th:text="${#temporals.format(a.endAt, 'HH:mm')}">08:15</td>
        </tr>
        </tbody>
    </table>
</div>
</body>
</html>
