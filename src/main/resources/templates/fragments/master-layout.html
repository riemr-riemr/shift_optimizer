<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
  <style>
    .table td, .table th { 
      vertical-align: middle; 
    }
    .color-picker-wrapper {
      position: relative;
      display: inline-block;
    }
    .color-preview {
      width: 30px;
      height: 30px;
      border: 1px solid #ccc;
      border-radius: 3px;
      display: inline-block;
      cursor: pointer;
      position: relative;
    }
    .color-input {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      opacity: 0;
      cursor: pointer;
    }
    .predefined-colors {
      display: flex;
      gap: 5px;
      flex-wrap: wrap;
      margin-top: 5px;
    }
    .color-option {
      width: 25px;
      height: 25px;
      border: 2px solid #ddd;
      border-radius: 3px;
      cursor: pointer;
      transition: border-color 0.2s;
    }
    .color-option:hover {
      border-color: #007bff;
    }
    .color-option.selected {
      border-color: #007bff;
      border-width: 3px;
    }
    .category-color-sample {
      width: 20px;
      height: 20px;
      border-radius: 3px;
      display: inline-block;
      border: 1px solid #ddd;
      margin-right: 8px;
    }
    .icon-selector {
      border: 1px solid #ddd;
      border-radius: 5px;
      padding: 10px;
      background-color: #f8f9fa;
    }
    .icon-option {
      text-align: center;
      padding: 10px;
      border: 2px solid transparent;
      border-radius: 5px;
      cursor: pointer;
      transition: all 0.2s;
      background-color: white;
    }
    .icon-option:hover {
      border-color: #007bff;
      background-color: #e3f2fd;
    }
    .icon-option.selected {
      border-color: #007bff;
      background-color: #e3f2fd;
    }
    .icon-option i {
      font-size: 24px;
      color: #495057;
    }
  </style>
</head>
<body>

<!-- Master List Template -->
<div th:fragment="master-list(title, icon, addButton, table)" class="card">
  <div class="card-header d-flex justify-content-between align-items-center">
    <span>
      <i th:if="${icon}" th:class="${icon}"></i>
      <span th:text="${title}"></span>
    </span>
    <div th:replace="${addButton}"></div>
  </div>
  <div class="card-body">
    <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>
    <div th:replace="${table}"></div>
  </div>
</div>

<!-- Master List with Modal Template -->
<div th:fragment="master-list-modal(title, icon, addModal, table, editModal)" class="card">
  <div class="card-header d-flex justify-content-between align-items-center">
    <span>
      <i th:if="${icon}" th:class="${icon}"></i>
      <span th:text="${title}"></span>
    </span>
    <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#addModal">
      <i class="bi bi-plus-lg"></i> 追加
    </button>
  </div>
  <div class="card-body">
    <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>
    <div th:replace="${table}"></div>
  </div>
  
  <!-- Add Modal -->
  <div th:replace="${addModal}"></div>
  
  <!-- Edit Modal -->
  <div th:replace="${editModal}"></div>
</div>

<!-- Simple Add Form Fragment -->
<div th:fragment="simple-add-form(action, fields, submitText)" class="mb-3">
  <form th:action="${action}" th:object="${form}" method="post" class="row g-2">
    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
    <div th:each="field : ${fields}" th:class="'col-' + ${field.colSize ?: 'auto'}">
      <div th:switch="${field.type}">
        <!-- Text Input -->
        <input th:case="'text'" 
               th:class="'form-control form-control-sm'" 
               th:placeholder="${field.placeholder}"
               th:field="*{__${field.name}__}"
               th:required="${field.required}">
        <!-- Number Input -->
        <input th:case="'number'" 
               type="number"
               th:class="'form-control form-control-sm'" 
               th:placeholder="${field.placeholder}"
               th:field="*{__${field.name}__}">
        <!-- Checkbox -->
        <div th:case="'checkbox'" class="form-check mt-1">
          <input th:class="'form-check-input'" 
                 type="checkbox" 
                 th:field="*{__${field.name}__}" 
                 th:id="${field.name}">
          <label th:class="'form-check-label'" th:for="${field.name}" th:text="${field.label}"></label>
        </div>
      </div>
    </div>
    <div class="col-auto">
      <button class="btn btn-sm btn-primary" type="submit" th:text="${submitText ?: '追加'}"></button>
    </div>
  </form>
</div>

<!-- Standard Table Fragment -->
<div th:fragment="standard-table(headers, rows)" class="table-responsive">
  <table class="table table-sm">
    <thead>
      <tr>
        <th th:each="header : ${headers}" th:text="${header}"></th>
      </tr>
    </thead>
    <tbody>
      <div th:replace="${rows}"></div>
    </tbody>
  </table>
</div>

<!-- Modal Base Fragment -->
<div th:fragment="base-modal(modalId, title, form, footer)" class="modal fade" th:id="${modalId}" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" th:text="${title}"></h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div th:replace="${form}"></div>
      <div class="modal-footer" th:replace="${footer}">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">キャンセル</button>
        <button type="submit" class="btn btn-primary">保存</button>
      </div>
    </div>
  </div>
</div>

<!-- Color Picker Fragment -->
<div th:fragment="color-picker(inputId, previewId)" class="mb-3">
  <label class="form-label">色</label>
  <div class="color-picker-wrapper">
    <div class="color-preview" th:id="${previewId}" style="background-color: #007bff;" 
         th:onclick="'document.getElementById(\'' + ${inputId} + '\').click()'"></div>
    <input type="color" class="color-input" name="color" th:id="${inputId}" value="#007bff">
  </div>
  <div class="predefined-colors">
    <div class="color-option" style="background-color: #007bff" data-color="#007bff"></div>
    <div class="color-option" style="background-color: #28a745" data-color="#28a745"></div>
    <div class="color-option" style="background-color: #dc3545" data-color="#dc3545"></div>
    <div class="color-option" style="background-color: #ffc107" data-color="#ffc107"></div>
    <div class="color-option" style="background-color: #17a2b8" data-color="#17a2b8"></div>
    <div class="color-option" style="background-color: #6f42c1" data-color="#6f42c1"></div>
    <div class="color-option" style="background-color: #fd7e14" data-color="#fd7e14"></div>
    <div class="color-option" style="background-color: #20c997" data-color="#20c997"></div>
    <div class="color-option" style="background-color: #6c757d" data-color="#6c757d"></div>
    <div class="color-option" style="background-color: #343a40" data-color="#343a40"></div>
  </div>
</div>

<!-- Icon Picker Fragment -->
<div th:fragment="icon-picker(inputId)" class="mb-3">
  <label class="form-label">アイコン</label>
  <div class="icon-selector">
    <div class="row g-2 mb-2">
      <div class="col-3">
        <div class="icon-option" data-icon="fas fa-cash-register">
          <i class="fas fa-cash-register"></i>
        </div>
      </div>
      <div class="col-3">
        <div class="icon-option" data-icon="fas fa-boxes">
          <i class="fas fa-boxes"></i>
        </div>
      </div>
      <div class="col-3">
        <div class="icon-option" data-icon="fas fa-broom">
          <i class="fas fa-broom"></i>
        </div>
      </div>
      <div class="col-3">
        <div class="icon-option" data-icon="fas fa-clipboard-list">
          <i class="fas fa-clipboard-list"></i>
        </div>
      </div>
    </div>
    <div class="row g-2 mb-2">
      <div class="col-3">
        <div class="icon-option" data-icon="fas fa-handshake">
          <i class="fas fa-handshake"></i>
        </div>
      </div>
      <div class="col-3">
        <div class="icon-option" data-icon="fas fa-file-alt">
          <i class="fas fa-file-alt"></i>
        </div>
      </div>
      <div class="col-3">
        <div class="icon-option" data-icon="fas fa-utensils">
          <i class="fas fa-utensils"></i>
        </div>
      </div>
      <div class="col-3">
        <div class="icon-option" data-icon="fas fa-shopping-cart">
          <i class="fas fa-shopping-cart"></i>
        </div>
      </div>
    </div>
    <div class="row g-2">
      <div class="col-3">
        <div class="icon-option" data-icon="fas fa-truck">
          <i class="fas fa-truck"></i>
        </div>
      </div>
      <div class="col-3">
        <div class="icon-option" data-icon="fas fa-tools">
          <i class="fas fa-tools"></i>
        </div>
      </div>
      <div class="col-3">
        <div class="icon-option" data-icon="fas fa-users">
          <i class="fas fa-users"></i>
        </div>
      </div>
      <div class="col-3">
        <div class="icon-option" data-icon="fas fa-cog">
          <i class="fas fa-cog"></i>
        </div>
      </div>
    </div>
  </div>
  <input type="hidden" name="icon" th:id="${inputId}">
</div>

<!-- Delete Button Fragment -->
<div th:fragment="delete-button(action, confirmText)" class="d-inline">
  <form th:action="${action}" method="post" class="d-inline" 
        th:onsubmit="'return confirm(\'' + (${confirmText} ?: 'このアイテムを削除しますか？') + '\')'">
    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
    <button class="btn btn-sm btn-outline-danger">削除</button>
  </form>
</div>

<!-- Edit Button Fragment -->
<div th:fragment="edit-button(buttonClass, dataAttributes)" class="d-inline">
  <button th:class="${buttonClass ?: 'btn btn-sm btn-outline-primary'}" 
          th:attrappend="${dataAttributes}">
    <i class="bi bi-pencil"></i> 編集
  </button>
</div>

<!-- Standard Add Modal Fragment -->
<div th:fragment="add-modal(modalId, title, formAction, formFields)" class="modal fade" th:id="${modalId}" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" th:text="${title}"></h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <form th:action="${formAction}" method="post">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
        <div class="modal-body">
          <div th:replace="${formFields}"></div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">キャンセル</button>
          <button type="submit" class="btn btn-primary">追加</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Standard Edit Modal Fragment -->
<div th:fragment="edit-modal(modalId, title, formFields)" class="modal fade" th:id="${modalId}" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" th:text="${title}"></h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <form th:id="'edit' + ${modalId.substring(4)} + 'Form'" method="post">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
        <div class="modal-body">
          <div th:replace="${formFields}"></div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">キャンセル</button>
          <button type="submit" class="btn btn-primary">更新</button>
        </div>
      </form>
    </div>
  </div>
</div>

</body>
</html>