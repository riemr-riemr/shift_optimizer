<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout}">
<head>
  <meta charset="UTF-8" />
  <title>画面権限管理</title>
</head>
<body>
<div layout:fragment="content">
  <div class="content-header">
    <h1><i class="bi bi-shield-lock"></i> 画面権限管理</h1>
    <p class="mb-0">役割ごとに各画面の参照・更新権限を設定します</p>
  </div>

  <form method="post" th:action="@{/permissions}">
    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
    <div class="card">
      <div class="card-header">権限マトリクス</div>
      <div class="card-body p-0">
        <table class="table table-hover mb-0">
          <thead class="table-light">
            <tr>
              <th>画面コード</th>
              <th th:each="r : ${roles}" th:text="${r.authorityCode}">ROLE</th>
            </tr>
          </thead>
          <tbody>
            <tr th:each="screen : ${screens}">
              <td>
                <div class="fw-semibold" th:text="${T(io.github.riemr.shift.util.ScreenCodes).NAMES.get(screen)}">画面名</div>
              </td>
              <td th:each="r : ${roles}">
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="checkbox"
                         th:name="${r.authorityCode + '|' + screen + '|view'}"
                         th:checked="${perm[r.authorityCode] != null and perm[r.authorityCode].get(screen) != null and perm[r.authorityCode].get(screen).canView}">
                  <label class="form-check-label">参照</label>
                </div>
                <div class="form-check form-check-inline ms-3">
                  <input class="form-check-input" type="checkbox"
                         th:name="${r.authorityCode + '|' + screen + '|update'}"
                         th:checked="${perm[r.authorityCode] != null and perm[r.authorityCode].get(screen) != null and perm[r.authorityCode].get(screen).canUpdate}">
                  <label class="form-check-label">更新</label>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="card-footer d-flex justify-content-end">
        <button type="submit" class="btn btn-primary"><i class="bi bi-save"></i> 保存</button>
      </div>
    </div>
  </form>
</div>
</body>
</html>
