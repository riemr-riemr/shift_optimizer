<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="io.github.riemr.shift.infrastructure.mapper.TaskMasterMapper">
  <resultMap id="BaseResultMap" type="io.github.riemr.shift.infrastructure.persistence.entity.TaskMaster">
    <id column="task_code" property="taskCode" />
    <result column="department_code" property="departmentCode" />
    <result column="category_code" property="categoryCode" />
    <result column="name" property="name" />
    <result column="description" property="description" />
    <result column="default_required_duration_minutes" property="defaultRequiredDurationMinutes" />
    <result column="priority" property="priority" />
    <result column="color" property="color" />
    <result column="icon" property="icon" />
  </resultMap>

  <sql id="Base_Column_List">
    task_code, department_code, category_code, name, description, default_required_duration_minutes,
    priority, color, icon
  </sql>

  <insert id="insert" parameterType="io.github.riemr.shift.infrastructure.persistence.entity.TaskMaster">
    insert into public.task_master (
      task_code, department_code, category_code, name, description, default_required_duration_minutes,
      priority, color, icon
    ) values (
      #{taskCode}, #{departmentCode}, #{categoryCode}, #{name}, #{description}, #{defaultRequiredDurationMinutes},
      #{priority}, #{color}, #{icon}
    )
  </insert>

  <insert id="upsert" parameterType="io.github.riemr.shift.infrastructure.persistence.entity.TaskMaster">
    insert into public.task_master (
      task_code, department_code, category_code, name, description, default_required_duration_minutes,
      priority, color, icon
    ) values (
      #{taskCode}, #{departmentCode}, #{categoryCode}, #{name}, #{description}, #{defaultRequiredDurationMinutes},
      #{priority}, #{color}, #{icon}
    )
    on conflict (task_code, department_code) do update set
      name = excluded.name,
      description = excluded.description,
      default_required_duration_minutes = excluded.default_required_duration_minutes,
      category_code = excluded.category_code,
      priority = excluded.priority,
      color = excluded.color,
      icon = excluded.icon
  </insert>

  <update id="updateByPrimaryKey" parameterType="io.github.riemr.shift.infrastructure.persistence.entity.TaskMaster">
    update public.task_master
    set name = #{name},
        description = #{description},
        default_required_duration_minutes = #{defaultRequiredDurationMinutes},
        department_code = #{departmentCode},
        category_code = #{categoryCode},
        priority = #{priority},
        color = #{color},
        icon = #{icon}
    where task_code = #{taskCode}
  </update>

  <delete id="deleteByPrimaryKey">
    delete from public.task_master where task_code = #{taskCode} and department_code = #{departmentCode}
  </delete>

  <select id="selectByPrimaryKey" resultMap="BaseResultMap">
    select <include refid="Base_Column_List" /> from public.task_master where task_code = #{taskCode} and department_code = #{departmentCode}
  </select>

  <select id="selectAll" resultMap="BaseResultMap">
    select <include refid="Base_Column_List" /> from public.task_master order by task_code
  </select>
</mapper>
