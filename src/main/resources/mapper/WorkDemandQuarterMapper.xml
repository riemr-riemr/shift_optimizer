<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="io.github.riemr.shift.infrastructure.mapper.WorkDemandQuarterMapper">
  <resultMap id="WorkDemandQuarterMap" type="io.github.riemr.shift.infrastructure.persistence.entity.WorkDemandQuarter">
    <id     column="demand_id"       property="demandId"/>
    <result column="store_code"      property="storeCode"/>
    <result column="department_code" property="departmentCode"/>
    <result column="demand_date"     property="demandDate"/>
    <result column="slot_time"       property="slotTime"/>
    <result column="task_code"       property="taskCode"/>
    <result column="required_units"  property="requiredUnits"/>
    <result column="group_id"        property="groupId"/>
  </resultMap>

  <select id="selectByDate" resultMap="WorkDemandQuarterMap">
    SELECT demand_id, store_code, department_code, demand_date, slot_time, task_code, required_units, group_id
    FROM work_demand_quarter
    WHERE store_code = #{storeCode}
      AND department_code = #{departmentCode}
      AND demand_date = #{date}
    ORDER BY slot_time, COALESCE(task_code, '')
  </select>

  <select id="selectByMonth" resultMap="WorkDemandQuarterMap">
    SELECT demand_id, store_code, department_code, demand_date, slot_time, task_code, required_units, group_id
    FROM work_demand_quarter
    WHERE store_code = #{storeCode}
      AND department_code = #{departmentCode}
      AND demand_date &gt;= #{from}
      AND demand_date &lt; #{to}
    ORDER BY demand_date, slot_time, COALESCE(task_code, '')
  </select>

  <insert id="insert" parameterType="io.github.riemr.shift.infrastructure.persistence.entity.WorkDemandQuarter">
    INSERT INTO work_demand_quarter (store_code, department_code, demand_date, slot_time, task_code, required_units, group_id)
    VALUES (#{storeCode}, #{departmentCode}, #{demandDate}, #{slotTime}, #{taskCode}, #{requiredUnits}, #{groupId})
  </insert>
</mapper>
