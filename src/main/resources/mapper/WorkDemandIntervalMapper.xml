<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="io.github.riemr.shift.infrastructure.mapper.WorkDemandIntervalMapper">

  <resultMap id="WorkDemandIntervalMap" type="io.github.riemr.shift.application.dto.DemandIntervalDto">
    <result column="store_code" property="storeCode"/>
    <result column="department_code" property="departmentCode"/>
    <result column="target_date" property="targetDate"/>
    <result column="from_time" property="from"/>
    <result column="to_time" property="to"/>
    <result column="demand" property="demand"/>
    <result column="task_code" property="taskCode"/>
    <result column="lane" property="lane"/>
  </resultMap>

  <select id="selectByDate" resultMap="WorkDemandIntervalMap">
    SELECT store_code, department_code, target_date, from_time, to_time, demand, task_code, lane
    FROM work_demand_interval
    WHERE store_code = #{storeCode}
      AND department_code = #{departmentCode}
      AND target_date = #{date}
    ORDER BY from_time, COALESCE(task_code, '')
  </select>

  <select id="selectByMonth" resultMap="WorkDemandIntervalMap">
    SELECT store_code, department_code, target_date, from_time, to_time, demand, task_code, lane
    FROM work_demand_interval
    WHERE store_code = #{storeCode}
      AND department_code = #{departmentCode}
      AND target_date &gt;= #{from}
      AND target_date &lt; #{to}
    ORDER BY target_date, from_time, COALESCE(task_code, '')
  </select>

  <insert id="insert" parameterType="io.github.riemr.shift.application.dto.DemandIntervalDto">
    INSERT INTO work_demand_interval (store_code, department_code, target_date, from_time, to_time, demand, task_code, lane)
    VALUES (#{storeCode}, #{departmentCode}, #{targetDate}, #{from}, #{to}, #{demand}, #{taskCode}, #{lane})
  </insert>

  <delete id="deleteById">
    DELETE FROM work_demand_interval WHERE id = #{id}
  </delete>

  <delete id="deleteAll">
    DELETE FROM work_demand_interval
  </delete>

  <delete id="deleteByStoreDeptAndRange">
    DELETE FROM work_demand_interval
    WHERE store_code = #{storeCode}
      AND department_code = #{departmentCode}
      AND target_date &gt;= #{from}
      AND target_date &lt;  #{to}
  </delete>

  <delete id="deleteByStoreAndRange">
    DELETE FROM work_demand_interval
    WHERE store_code = #{storeCode}
      AND target_date &gt;= #{from}
      AND target_date &lt;  #{to}
  </delete>

</mapper>
