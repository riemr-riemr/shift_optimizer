<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="io.github.riemr.shift.infrastructure.mapper.DaysMasterMapper">
  <resultMap id="BaseResultMap" type="io.github.riemr.shift.infrastructure.persistence.entity.DaysMaster">
    <id column="days_id" property="daysId" />
    <result column="store_code" property="storeCode" />
    <result column="kind" property="kind" />
    <result column="day_of_week" property="dayOfWeek" />
    <result column="special_date" property="specialDate" />
    <result column="label" property="label" />
    <result column="active" property="active" />
  </resultMap>

  <sql id="Base_Column_List">
    days_id, store_code, kind, day_of_week, special_date, label, active
  </sql>

  <insert id="insert" parameterType="io.github.riemr.shift.infrastructure.persistence.entity.DaysMaster">
    insert into public.days_master (
      store_code, kind, day_of_week, special_date, label, active
    ) values (
      #{storeCode}, #{kind}, #{dayOfWeek}, #{specialDate}, #{label}, coalesce(#{active}, true)
    )
  </insert>

  <delete id="deleteByPrimaryKey" parameterType="long">
    delete from public.days_master where days_id = #{daysId}
  </delete>

  <select id="selectSpecialByStore" parameterType="string" resultMap="BaseResultMap">
    select <include refid="Base_Column_List" /> from public.days_master
    where store_code = #{storeCode}
      and kind = 'SPECIAL'
      and active = true
    order by special_date
  </select>
</mapper>

