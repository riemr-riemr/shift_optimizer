<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="io.github.riemr.shift.infrastructure.mapper.EmployeeMonthlyHoursSettingMapper">
  <resultMap id="BaseResultMap" type="io.github.riemr.shift.infrastructure.persistence.entity.EmployeeMonthlyHoursSetting">
    <id     column="employee_code"  property="employeeCode" />
    <result column="month_start"    property="monthStart"    jdbcType="DATE" />
    <result column="min_work_hours" property="minWorkHours"  jdbcType="INTEGER" />
    <result column="max_work_hours" property="maxWorkHours"  jdbcType="INTEGER" />
  </resultMap>

  <select id="selectByEmployee" parameterType="string" resultMap="BaseResultMap">
    SELECT employee_code, month_start, min_work_hours, max_work_hours
      FROM employee_monthly_hours_setting
     WHERE employee_code = #{employeeCode}
     ORDER BY month_start
  </select>

  <select id="selectByMonth" parameterType="date" resultMap="BaseResultMap">
    SELECT employee_code, month_start, min_work_hours, max_work_hours
      FROM employee_monthly_hours_setting
     WHERE month_start = #{monthStart}
  </select>

  <delete id="deleteByEmployee" parameterType="string">
    DELETE FROM employee_monthly_hours_setting WHERE employee_code = #{employeeCode}
  </delete>

  <insert id="upsert" parameterType="io.github.riemr.shift.infrastructure.persistence.entity.EmployeeMonthlyHoursSetting">
    INSERT INTO employee_monthly_hours_setting (employee_code, month_start, min_work_hours, max_work_hours)
    VALUES (#{employeeCode}, #{monthStart}, #{minWorkHours}, #{maxWorkHours})
    ON CONFLICT (employee_code, month_start) DO UPDATE SET
      min_work_hours = EXCLUDED.min_work_hours,
      max_work_hours = EXCLUDED.max_work_hours
  </insert>
</mapper>
