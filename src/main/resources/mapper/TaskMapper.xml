<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="io.github.riemr.shift.infrastructure.mapper.TaskMapper">
  <resultMap id="BaseResultMap" type="io.github.riemr.shift.infrastructure.persistence.entity.Task">
    <id column="task_id" jdbcType="BIGINT" property="taskId" />
    <result column="store_code" jdbcType="VARCHAR" property="storeCode" />
    <result column="work_date" jdbcType="DATE" property="workDate" />
    <result column="name" jdbcType="VARCHAR" property="name" />
    <result column="description" jdbcType="VARCHAR" property="description" />
    <result column="schedule_type" jdbcType="VARCHAR" property="scheduleType" />
    <result column="fixed_start_at" jdbcType="TIMESTAMP" property="fixedStartAt" />
    <result column="fixed_end_at" jdbcType="TIMESTAMP" property="fixedEndAt" />
    <result column="window_start_at" jdbcType="TIMESTAMP" property="windowStartAt" />
    <result column="window_end_at" jdbcType="TIMESTAMP" property="windowEndAt" />
    <result column="required_duration_minutes" jdbcType="INTEGER" property="requiredDurationMinutes" />
    <result column="required_skill_code" jdbcType="VARCHAR" property="requiredSkillCode" />
    <result column="required_staff_count" jdbcType="INTEGER" property="requiredStaffCount" />
    <result column="priority" jdbcType="INTEGER" property="priority" />
    <result column="must_be_contiguous" jdbcType="SMALLINT" property="mustBeContiguous" />
    <result column="created_by" jdbcType="VARCHAR" property="createdBy" />
    <result column="created_at" jdbcType="TIMESTAMP" property="createdAt" />
    <result column="updated_by" jdbcType="VARCHAR" property="updatedBy" />
    <result column="updated_at" jdbcType="TIMESTAMP" property="updatedAt" />
  </resultMap>

  <sql id="Base_Column_List">
    task_id, store_code, work_date, name, description, schedule_type,
    fixed_start_at, fixed_end_at, window_start_at, window_end_at,
    required_duration_minutes, required_skill_code, required_staff_count,
    priority, must_be_contiguous, created_by, created_at, updated_by, updated_at
  </sql>

  <select id="selectByPrimaryKey" parameterType="long" resultMap="BaseResultMap">
    select <include refid="Base_Column_List" />
    from public.task
    where task_id = #{taskId}
  </select>

  <insert id="insert" parameterType="io.github.riemr.shift.infrastructure.persistence.entity.Task">
    insert into public.task (
      store_code, work_date, name, description, schedule_type,
      fixed_start_at, fixed_end_at, window_start_at, window_end_at,
      required_duration_minutes, required_skill_code, required_staff_count,
      priority, must_be_contiguous, created_by, created_at, updated_by, updated_at
    ) values (
      #{storeCode}, #{workDate}, #{name}, #{description}, #{scheduleType},
      #{fixedStartAt}, #{fixedEndAt}, #{windowStartAt}, #{windowEndAt},
      #{requiredDurationMinutes}, #{requiredSkillCode}, #{requiredStaffCount},
      #{priority}, #{mustBeContiguous}, #{createdBy}, #{createdAt}, #{updatedBy}, #{updatedAt}
    )
  </insert>

  <update id="updateByPrimaryKey" parameterType="io.github.riemr.shift.infrastructure.persistence.entity.Task">
    update public.task
    set store_code = #{storeCode},
        work_date = #{workDate},
        name = #{name},
        description = #{description},
        schedule_type = #{scheduleType},
        fixed_start_at = #{fixedStartAt},
        fixed_end_at = #{fixedEndAt},
        window_start_at = #{windowStartAt},
        window_end_at = #{windowEndAt},
        required_duration_minutes = #{requiredDurationMinutes},
        required_skill_code = #{requiredSkillCode},
        required_staff_count = #{requiredStaffCount},
        priority = #{priority},
        must_be_contiguous = #{mustBeContiguous},
        created_by = #{createdBy},
        created_at = #{createdAt},
        updated_by = #{updatedBy},
        updated_at = #{updatedAt}
    where task_id = #{taskId}
  </update>

  <delete id="deleteByPrimaryKey" parameterType="long">
    delete from public.task where task_id = #{taskId}
  </delete>

  <select id="selectByStoreAndDate" resultMap="BaseResultMap">
    select <include refid="Base_Column_List" />
    from public.task
    where store_code = #{storeCode}
      and work_date = #{workDate}
    order by priority nulls last, task_id
  </select>

  <delete id="deleteByStoreAndDateRange">
    delete from public.task
    where store_code = #{storeCode}
      and work_date between #{from} and #{to}
  </delete>
</mapper>
