<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="io.github.riemr.shift.infrastructure.mapper.AttendanceGroupConstraintMapper">
  <resultMap id="BaseResultMap" type="io.github.riemr.shift.infrastructure.persistence.entity.AttendanceGroupConstraint">
    <id column="constraint_id" property="constraintId" />
    <result column="store_code" property="storeCode" />
    <result column="department_code" property="departmentCode" />
    <result column="rule_type" property="ruleType" />
    <result column="min_on_duty" property="minOnDuty" />
    <result column="created_at" property="createdAt" />
    <result column="updated_at" property="updatedAt" />
  </resultMap>

  <select id="selectByStoreAndDepartment" resultMap="BaseResultMap">
    select constraint_id, store_code, department_code, rule_type, min_on_duty, created_at, updated_at
    from attendance_group_constraint
    where store_code = #{storeCode}
    <if test="departmentCode != null and departmentCode != ''">
      and (department_code = #{departmentCode} or department_code is null)
    </if>
    <if test="departmentCode == null or departmentCode == ''">
      and department_code is null
    </if>
    order by constraint_id
  </select>

  <insert id="insert" parameterType="io.github.riemr.shift.infrastructure.persistence.entity.AttendanceGroupConstraint"
          useGeneratedKeys="true" keyProperty="constraintId">
    insert into attendance_group_constraint (store_code, department_code, rule_type, min_on_duty, created_at, updated_at)
    values (#{storeCode}, #{departmentCode}, #{ruleType}, #{minOnDuty}, now(), now())
  </insert>

  <delete id="deleteByPrimaryKey" parameterType="long">
    delete from attendance_group_constraint where constraint_id = #{constraintId}
  </delete>
</mapper>
