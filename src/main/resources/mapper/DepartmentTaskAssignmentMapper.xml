<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="io.github.riemr.shift.infrastructure.mapper.DepartmentTaskAssignmentMapper">
  <resultMap id="BaseResultMap" type="io.github.riemr.shift.infrastructure.persistence.entity.DepartmentTaskAssignment">
    <id     column="assignment_id"  property="assignmentId"/>
    <result column="store_code"     property="storeCode"/>
    <result column="department_code" property="departmentCode"/>
    <result column="task_code"      property="taskCode"/>
    <result column="employee_code"  property="employeeCode"/>
    <result column="start_at"       property="startAt"/>
    <result column="end_at"         property="endAt"/>
    <result column="created_by"     property="createdBy"/>
  </resultMap>

  <insert id="insert" parameterType="io.github.riemr.shift.infrastructure.persistence.entity.DepartmentTaskAssignment">
    INSERT INTO department_task_assignment (
      store_code, department_code, task_code, employee_code, start_at, end_at, created_by
    ) VALUES (
      #{storeCode}, #{departmentCode}, #{taskCode}, #{employeeCode}, #{startAt}, #{endAt}, #{createdBy}
    )
  </insert>

  <delete id="deleteByMonthStoreAndDepartment">
    <![CDATA[
    DELETE FROM department_task_assignment
    WHERE store_code = #{storeCode}
      AND department_code = #{departmentCode}
      AND start_at >= #{from}
      AND start_at <  #{to}
    ]]>
  </delete>

  <select id="selectByMonth" resultMap="BaseResultMap">
    <![CDATA[
    SELECT assignment_id, store_code, department_code, task_code, employee_code, start_at, end_at, created_by
    FROM department_task_assignment
    WHERE store_code = #{storeCode}
      AND department_code = #{departmentCode}
      AND start_at >= #{from}
      AND start_at <  #{to}
    ORDER BY start_at
    ]]>
  </select>

  <select id="selectByDate" resultMap="BaseResultMap">
    <![CDATA[
    SELECT assignment_id, store_code, department_code, task_code, employee_code, start_at, end_at, created_by
    FROM department_task_assignment
    WHERE store_code = #{storeCode}
      AND department_code = #{departmentCode}
      AND start_at >= #{from}
      AND start_at <  #{to}
    ORDER BY start_at
    ]]>
  </select>
</mapper>
